ERROR THIS SHOULD GO AWAY

#!/usr/local/bin/haserl --shell=lua
Content-type: text/html

<!-- Copyright 2011 Big Switch Networks -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Indigo Logs</title>
</head>

<% 
   require "web_common"
   require "platform"
   require "ui_utils"
   require "ui_cs_op"
   print(top_matter)
%>

<h1>Logs</h1>

<form name="input" action="logs" method="POST">

<%
   selected = "ofproto"
   if FORM and FORM.log then selected = FORM.log end

   content = ""
   if ENV["REQUEST_METHOD"] == "POST" then
      if FORM.log == "drvdbg" then
         status, results, err_str = cs_info_get()
         if results == nil or #results == 0 then
            content = "Unable to retrieve information from driver\n"
         else
            for i, entry in ipairs(results) do
               content = content .. entry.info .. "\n"
            end
         end
      elseif FORM.log == "cxnlog" then
         entries = get_ctrl_history()
         for i,ent in ipairs(entries) do
            content = content .. os.date(ent.time) .. ": " ..
               ent.state .. ": " .. ent.ctrl_ip .. "\n"
         end
      else
         local filename = log_dir .. "/" .. FORM.log .. ".log"
         content = read_file(filename)
         if not content then
            content = "ERROR: Could not open " .. tostring(filename)
         end
      end
   end
%>

<select name="log" size="1" >
<option name="cmdsrv" 
<% get_chk_val(selected, "cmdsrv", "selected") %>
value="cmdsrv">Command Server</option>
<option name="ofproto" 
<% get_chk_val(selected, "ofproto", "selected") %>
value="ofproto">OpenFlow Protocol Daemon</option>
<option name="ofswd" 
<% get_chk_val(selected, "ofswd", "selected") %>
value="ofswd">OpenFlow Switch Daemon</option><br>
<option name="cmdsrv" 
<% get_chk_val(selected, "cxnlog", "selected") %>
value="cxnlog">Controller Connection History</option>
<option name="drvdbg" 
<% get_chk_val(selected, "drvdbg", "selected") %>
value="drvdbg">Driver Debug</option>
</select>

<input type="submit" value="Refresh Log" /></td>
</form> 

<%
   if content then
      print("<h2>")
      if FORM.log == "cmdsrv" then
         print("Command Server Log<\h2>")
      elseif FORM.log == "ofproto" then
         print("Protocol Daemon Log<\h2>")
      elseif FORM.log == "ofswd" then
         print("Switch Datapath Daemon Log<\h2>")
      elseif FORM.log == "cxnlog" then
         print("Controller Connection History<\h2>")
      elseif FORM.log == "drvdbg" then
         print("Driver Debug Log<\h2>")
      end
      print("</h2>Current time: ".. os.date().. "<br>")
      print("<textarea cols='120' rows='40' readonly>")
      print(content)
      print("</textarea>")
   end
%>

</body>
</html>
